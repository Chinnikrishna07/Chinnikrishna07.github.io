<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stoplight Game - Nash Equilibrium</title>
  <style>
    /* Reset default browser styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Main body styling with gradient background */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    /* Main container for the game */
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    /* Title styling */
    h1 {
      text-align: center;
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2.5rem;
    }

    /* Subtitle styling */
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1rem;
    }

    /* Game explanation section */
    .explanation {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      border-left: 4px solid #667eea;
    }

    .explanation h3 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .explanation p {
      color: #555;
      line-height: 1.6;
      margin-bottom: 10px;
    }

    /* Payoff matrix styling */
    .payoff-matrix {
      background: #f0f4ff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
    }

    .payoff-matrix h3 {
      color: #667eea;
      margin-bottom: 15px;
      text-align: center;
    }

    /* Table for displaying payoffs */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    /* Table header and cell styling */
    th, td {
      border: 2px solid #667eea;
      padding: 15px;
      text-align: center;
      font-weight: 600;
    }

    /* Header row styling */
    th {
      background: #667eea;
      color: white;
    }

    /* Highlight Nash Equilibrium cells */
    .nash-eq {
      background: #90ee90;
      font-weight: bold;
    }

    /* Game area section */
    .game-area {
      background: #f8f9fa;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
      text-align: center;
    }

    .game-area h3 {
      color: #667eea;
      margin-bottom: 20px;
    }

    /* Computer player section - shows as mysterious before choice */
    .computer-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
      text-align: center;
      color: white;
    }

    .computer-section h3 {
      margin-bottom: 15px;
      font-size: 1.5rem;
    }

    .computer-thinking {
      font-size: 3rem;
      margin: 20px 0;
      animation: pulse 1.5s ease-in-out infinite;
    }

    /* Pulsing animation for computer thinking */
    @keyframes pulse {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }

    /* Button group container for player choices */
    .choice-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 20px;
    }

    /* Choice button styling */
    .choice-btn {
      padding: 20px 40px;
      font-size: 1.3rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 700;
      min-width: 180px;
    }

    /* Swerve button - green theme */
    .swerve {
      background: #4CAF50;
      color: white;
    }

    .swerve:hover {
      background: #45a049;
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(76, 175, 80, 0.4);
    }

    /* Straight button - red theme */
    .straight {
      background: #f44336;
      color: white;
    }

    .straight:hover {
      background: #da190b;
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(244, 67, 54, 0.4);
    }

    /* Results section (hidden initially) */
    .results {
      background: #f8f9fa;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 3px solid #667eea;
      display: none;
    }

    .results.show {
      display: block;
      animation: slideIn 0.5s ease-out;
    }

    /* Animation for results appearing */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .results h3 {
      color: #667eea;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.8rem;
    }

    /* Visual representation of the collision */
    .collision-visual {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      margin: 30px 0;
      font-size: 4rem;
    }

    .car {
      text-align: center;
      animation: slideInCar 0.8s ease-out;
    }

    /* Animation for cars appearing */
    @keyframes slideInCar {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .car:last-child {
      animation: slideInCarRight 0.8s ease-out;
    }

    @keyframes slideInCarRight {
      from {
        opacity: 0;
        transform: translateX(50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .car-label {
      font-size: 1rem;
      font-weight: 600;
      color: #667eea;
      margin-top: 10px;
    }

    .car-action {
      margin-top: 10px;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1rem;
    }

    /* Crash animation */
    .crash-icon {
      animation: crash 0.5s ease-out;
      font-size: 5rem;
    }

    @keyframes crash {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.5); }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Result details styling */
    .result-details {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .result-item {
      padding: 15px;
      margin-bottom: 10px;
      border-left: 4px solid #667eea;
      background: #f8f9fa;
      border-radius: 5px;
    }

    .result-item strong {
      color: #667eea;
    }

    /* Outcome message styling */
    .outcome {
      font-size: 1.4rem;
      text-align: center;
      padding: 25px;
      border-radius: 10px;
      margin-top: 20px;
      font-weight: 700;
    }

    /* Win outcome */
    .outcome.win {
      background: #d4edda;
      color: #155724;
      border: 3px solid #c3e6cb;
    }

    /* Lose outcome */
    .outcome.lose {
      background: #f8d7da;
      color: #721c24;
      border: 3px solid #f5c6cb;
    }

    /* Tie outcome */
    .outcome.tie {
      background: #fff3cd;
      color: #856404;
      border: 3px solid #ffeaa7;
    }

    /* Nash Equilibrium info box */
    .nash-info {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      border-left: 5px solid #28a745;
    }

    /* Play again button */
    .play-again-btn {
      width: 100%;
      padding: 20px;
      font-size: 1.3rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .play-again-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    /* Statistics section */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .stat-box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid #e0e0e0;
      transition: all 0.3s ease;
    }

    .stat-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-box .label {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .stat-box .value {
      color: #667eea;
      font-size: 2rem;
      font-weight: 700;
    }

    /* Responsive design for smaller screens */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }

      h1 {
        font-size: 2rem;
      }

      .choice-buttons {
        flex-direction: column;
      }

      .choice-btn {
        width: 100%;
      }

      .collision-visual {
        font-size: 3rem;
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Game title and subtitle -->
    <h1>🚦 Stoplight Game 🚦</h1>
    <p class="subtitle">Demonstrating Nash Equilibrium in Game Theory</p>

    <!-- Game explanation section -->
    <div class="explanation">
      <h3>📚 How the Game Works</h3>
      <p><strong>Scenario:</strong> Two cars are driving toward each other on a collision course. Each driver must decide whether to <strong>SWERVE</strong> or go <strong>STRAIGHT</strong>.</p>
      <p><strong>Outcomes:</strong></p>
      <ul style="margin-left: 20px; color: #555;">
        <li>If both <strong>SWERVE</strong>: Both lose some dignity (0, 0)</li>
        <li>If one <strong>SWERVES</strong> and other goes <strong>STRAIGHT</strong>: Straight driver wins (+1), Swerve driver loses (-1)</li>
        <li>If both go <strong>STRAIGHT</strong>: Both crash and lose heavily (-10, -10)</li>
      </ul>
      <p><strong>Nash Equilibrium:</strong> The best strategies are when one player swerves and the other goes straight. Neither player can improve by changing their choice alone.</p>
    </div>

    <!-- Payoff matrix display -->
    <div class="payoff-matrix">
      <h3>📊 Payoff Matrix</h3>
      <table>
        <tr>
          <th></th>
          <th>Computer: Swerve</th>
          <th>Computer: Straight</th>
        </tr>
        <tr>
          <th>Human: Swerve</th>
          <td>(0, 0)</td>
          <td class="nash-eq">(-1, +1) ⭐</td>
        </tr>
        <tr>
          <th>Human: Straight</th>
          <td class="nash-eq">(+1, -1) ⭐</td>
          <td>(-10, -10)</td>
        </tr>
      </table>
      <p style="margin-top: 10px; text-align: center; color: #666; font-size: 0.9rem;">
        ⭐ = Nash Equilibrium positions | Format: (Human payoff, Computer payoff)
      </p>
    </div>

    <!-- Computer player section - mysterious before game -->
    <div class="computer-section" id="computerSection">
      <h3>🤖 Computer is Ready...</h3>
      <div class="computer-thinking">🎲</div>
      <p>The computer has already made its choice!</p>
      <p style="font-size: 0.9rem; opacity: 0.9; margin-top: 10px;">What will you choose?</p>
    </div>

    <!-- Human player choice section -->
    <div class="game-area" id="gameArea">
      <h3>👤 Make Your Choice</h3>
      <p style="color: #666; margin-bottom: 20px;">Choose wisely - the computer has already decided!</p>
      <div class="choice-buttons">
        <!-- Swerve button for human player -->
        <button class="choice-btn swerve" onclick="makeChoice('swerve')">
          🔄 SWERVE
        </button>
        <!-- Straight button for human player -->
        <button class="choice-btn straight" onclick="makeChoice('straight')">
          ➡️ GO STRAIGHT
        </button>
      </div>
    </div>

    <!-- Results section (hidden until player makes choice) -->
    <div class="results" id="results">
      <h3>🎯 Game Results</h3>
      
      <!-- Visual representation of collision outcome -->
      <div class="collision-visual" id="collisionVisual">
        <!-- This will be populated dynamically -->
      </div>

      <!-- Result details -->
      <div class="result-details">
        <div class="result-item">
          <strong>Your Choice:</strong> <span id="humanChoice"></span>
        </div>
        <div class="result-item">
          <strong>Computer Choice:</strong> <span id="computerChoice"></span>
        </div>
        <div class="result-item">
          <strong>Your Payoff:</strong> <span id="humanPayoff"></span> points
        </div>
        <div class="result-item">
          <strong>Computer Payoff:</strong> <span id="computerPayoff"></span> points
        </div>
      </div>
      
      <!-- Outcome message -->
      <div class="outcome" id="outcome"></div>

      <!-- Nash Equilibrium indicator -->
      <div class="nash-info" id="nashInfo"></div>

      <!-- Play again button -->
      <button class="play-again-btn" onclick="resetGame()">
        🔄 Play Again
      </button>
    </div>

    <!-- Game statistics -->
    <div class="stats">
      <div class="stat-box">
        <div class="label">Games Played</div>
        <div class="value" id="gamesPlayed">0</div>
      </div>
      <div class="stat-box">
        <div class="label">Wins</div>
        <div class="value" id="wins">0</div>
      </div>
      <div class="stat-box">
        <div class="label">Losses</div>
        <div class="value" id="losses">0</div>
      </div>
      <div class="stat-box">
        <div class="label">Ties</div>
        <div class="value" id="ties">0</div>
      </div>
      <div class="stat-box">
        <div class="label">Crashes</div>
        <div class="value" id="crashes">0</div>
      </div>
    </div>
  </div>

  <script>
    // Global variables to store game state
    let computerChoice = null;   // Stores the computer's pre-determined choice
    let gamesPlayed = 0;         // Counter for total games played
    let wins = 0;                // Counter for human wins
    let losses = 0;              // Counter for human losses
    let ties = 0;                // Counter for ties
    let crashes = 0;             // Counter for crashes (both go straight)

    /**
     * Function to initialize the game - computer makes its choice immediately
     * This happens when the page loads, before human player chooses
     */
    function initializeGame() {
      // Computer makes random choice using Math.random()
      // Math.random() returns a number between 0 and 1
      const random = Math.random();
      
      // If random < 0.5, computer chooses 'swerve', otherwise 'straight'
      computerChoice = random < 0.5 ? 'swerve' : 'straight';
      
      // Computer's choice is hidden from the player until they make their choice
      console.log('Computer has made its choice (hidden from player)');
    }

    /**
     * Main function that executes when human player makes their choice
     * @param {string} humanChoice - Either 'swerve' or 'straight'
     */
    function makeChoice(humanChoice) {
      // Hide the game area (choice buttons)
      document.getElementById('gameArea').style.display = 'none';
      
      // Initialize payoff variables
      let humanPayoff = 0;      // Points earned/lost by human
      let computerPayoff = 0;   // Points earned/lost by computer
      let outcomeMessage = '';  // Message describing the outcome
      let outcomeClass = '';    // CSS class for styling outcome
      let isNashEquilibrium = false;  // Whether this outcome is Nash Equilibrium
      let collisionHTML = '';   // HTML for visual representation

      // Calculate payoffs based on game theory matrix
      // This implements the payoff rules from the explanation section
      
      if (humanChoice === 'swerve' && computerChoice === 'swerve') {
        // Both players swerved - nobody wins, tie game
        humanPayoff = 0;
        computerPayoff = 0;
        outcomeMessage = '🤝 Both Swerved - Tie Game!';
        outcomeClass = 'tie';
        ties++;  // Increment tie counter
        
        // Visual: Both cars swerving away from each other
        collisionHTML = `
          <div class="car">
            <div style="font-size: 4rem;">🚗</div>
            <div class="car-label">You</div>
            <div class="car-action" style="background: #4CAF50; color: white;">SWERVED</div>
          </div>
          <div style="font-size: 3rem;">↔️</div>
          <div class="car">
            <div style="font-size: 4rem;">🚙</div>
            <div class="car-label">Computer</div>
            <div class="car-action" style="background: #4CAF50; color: white;">SWERVED</div>
          </div>
        `;
        
      } else if (humanChoice === 'swerve' && computerChoice === 'straight') {
        // Human swerved, computer went straight - human loses
        humanPayoff = -1;
        computerPayoff = 1;
        outcomeMessage = '😔 You Swerved, Computer Went Straight - You Lose!';
        outcomeClass = 'lose';
        losses++;  // Increment loss counter
        isNashEquilibrium = true;  // This is a Nash Equilibrium position
        
        // Visual: Human swerves, computer goes straight
        collisionHTML = `
          <div class="car">
            <div style="font-size: 4rem;">🚗</div>
            <div class="car-label">You</div>
            <div class="car-action" style="background: #4CAF50; color: white;">SWERVED</div>
          </div>
          <div style="font-size: 3rem;">😰</div>
          <div class="car">
            <div style="font-size: 4rem;">🚙</div>
            <div class="car-label">Computer</div>
            <div class="car-action" style="background: #f44336; color: white;">STRAIGHT</div>
          </div>
        `;
        
      } else if (humanChoice === 'straight' && computerChoice === 'swerve') {
        // Human went straight, computer swerved - human wins
        humanPayoff = 1;
        computerPayoff = -1;
        outcomeMessage = '🎉 Computer Swerved, You Went Straight - You Win!';
        outcomeClass = 'win';
        wins++;  // Increment win counter
        isNashEquilibrium = true;  // This is a Nash Equilibrium position
        
        // Visual: Human goes straight, computer swerves
        collisionHTML = `
          <div class="car">
            <div style="font-size: 4rem;">🚗</div>
            <div class="car-label">You</div>
            <div class="car-action" style="background: #f44336; color: white;">STRAIGHT</div>
          </div>
          <div style="font-size: 3rem;">😎</div>
          <div class="car">
            <div style="font-size: 4rem;">🚙</div>
            <div class="car-label">Computer</div>
            <div class="car-action" style="background: #4CAF50; color: white;">SWERVED</div>
          </div>
        `;
        
      } else if (humanChoice === 'straight' && computerChoice === 'straight') {
        // Both went straight - CRASH! Both lose heavily
        humanPayoff = -10;
        computerPayoff = -10;
        outcomeMessage = '💥 CATASTROPHIC CRASH! Both Went Straight!';
        outcomeClass = 'lose';
        losses++;  // Increment loss counter
        crashes++;  // Increment crash counter
        
        // Visual: Both cars crashing
        collisionHTML = `
          <div class="car">
            <div style="font-size: 4rem;">🚗</div>
            <div class="car-label">You</div>
            <div class="car-action" style="background: #f44336; color: white;">STRAIGHT</div>
          </div>
          <div class="crash-icon">💥</div>
          <div class="car">
            <div style="font-size: 4rem;">🚙</div>
            <div class="car-label">Computer</div>
            <div class="car-action" style="background: #f44336; color: white;">STRAIGHT</div>
          </div>
        `;
      }

      // Increment total games played counter
      gamesPlayed++;

      // Update the results section with calculated values
      document.getElementById('humanChoice').textContent = humanChoice.toUpperCase();
      document.getElementById('computerChoice').textContent = computerChoice.toUpperCase();
      document.getElementById('humanPayoff').textContent = humanPayoff;
      document.getElementById('computerPayoff').textContent = computerPayoff;
      document.getElementById('outcome').textContent = outcomeMessage;
      document.getElementById('outcome').className = 'outcome ' + outcomeClass;

      // Display the visual collision representation
      document.getElementById('collisionVisual').innerHTML = collisionHTML;

      // Display Nash Equilibrium analysis
      const nashInfo = document.getElementById('nashInfo');
      if (isNashEquilibrium) {
        // If this outcome is a Nash Equilibrium, explain why
        nashInfo.innerHTML = `
          <strong style="color: #28a745;">⭐ Nash Equilibrium Achieved!</strong><br>
          <p style="margin-top: 10px; color: #555;">
            This is a Nash Equilibrium because neither player can improve their payoff by 
            unilaterally changing their strategy. If you changed your choice, you'd get -10 
            (crash) instead of ${humanPayoff}. If the computer changed, it would get -10 
            instead of ${computerPayoff}.
          </p>
        `;
        nashInfo.style.borderLeft = '5px solid #28a745';
        nashInfo.style.background = '#d4edda';
        
      } else if (humanChoice === 'straight' && computerChoice === 'straight') {
        // If both crashed, explain this is not Nash Equilibrium
        nashInfo.innerHTML = `
          <strong style="color: #dc3545;">⚠️ Not a Nash Equilibrium!</strong><br>
          <p style="margin-top: 10px; color: #555;">
            This crash outcome is NOT a Nash Equilibrium. Both players would benefit from 
            changing their strategy. If either player had swerved, they would have gotten 
            -1 instead of -10. This demonstrates why rational players avoid this outcome.
          </p>
        `;
        nashInfo.style.borderLeft = '5px solid #dc3545';
        nashInfo.style.background = '#f8d7da';
        
      } else {
        // If both swerved (tie), explain the coordination aspect
        nashInfo.innerHTML = `
          <strong style="color: #856404;">ℹ️ Coordination Outcome</strong><br>
          <p style="margin-top: 10px; color: #555;">
            Both swerved - a safe coordination outcome, but not a Nash Equilibrium. 
            Either player could change to "straight" and improve their payoff from 0 to +1 
            (assuming the other still swerves). This shows the strategic tension in the game.
          </p>
        `;
        nashInfo.style.borderLeft = '5px solid #ffc107';
        nashInfo.style.background = '#fff3cd';
      }

      // Show the results section with animation
      document.getElementById('results').classList.add('show');

      // Update statistics display
      document.getElementById('gamesPlayed').textContent = gamesPlayed;
      document.getElementById('wins').textContent = wins;
      document.getElementById('losses').textContent = losses;
      document.getElementById('ties').textContent = ties;
      document.getElementById('crashes').textContent = crashes;
    }

    /**
     * Function to reset the game for a new round
     * Hides results and shows choice buttons again
     */
    function resetGame() {
      // Hide results section
      document.getElementById('results').classList.remove('show');
      
      // Show game area (choice buttons) again
      document.getElementById('gameArea').style.display = 'block';
      
      // Computer makes a new random choice for the next round
      initializeGame();
    }

    // Initialize the game when page loads
    // Computer makes its first choice before player sees anything
    initializeGame();
  </script>
  <script src="../Q6/event_tracker.js"></script>
</body>
</html>